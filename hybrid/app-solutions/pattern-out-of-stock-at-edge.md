---
title: Обнаружение отсутствия товаров с помощью Azure и Azure Stack Edge
description: Узнайте, как с помощью служб Azure и устройства Azure Stack Edge отслеживать наличие товара.
author: BryanLa
ms.topic: article
ms.date: 05/24/2021
ms.author: bryanla
ms.reviewer: anajod
ms.lastreviewed: 05/24/2021
ms.openlocfilehash: b25a6391c4e64fa7018031bac4fb7d098c56b529
ms.sourcegitcommit: cf2c4033d1b169f5b63980ce1865281366905e2e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/25/2021
ms.locfileid: "110343881"
---
# <a name="out-of-stock-detection-at-the-edge-pattern"></a><span data-ttu-id="4cc63-103">Шаблон обнаружения отсутствия товаров на пограничных устройствах</span><span class="sxs-lookup"><span data-stu-id="4cc63-103">Out of stock detection at the edge pattern</span></span>

<span data-ttu-id="4cc63-104">В этом шаблоне показано, как определить отсутствие товаров на полках с помощью устройства Azure Stack Edge или Azure IoT Edge и сетевых камер.</span><span class="sxs-lookup"><span data-stu-id="4cc63-104">This pattern illustrates how to determine if shelves have out of stock items using an Azure Stack Edge or Azure IoT Edge device and network cameras.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="4cc63-105">Контекст и проблема</span><span class="sxs-lookup"><span data-stu-id="4cc63-105">Context and problem</span></span>

<span data-ttu-id="4cc63-106">В обычных розничных магазинах уровень продаж снижается из-за отсутствия нужного клиентам товара на полке.</span><span class="sxs-lookup"><span data-stu-id="4cc63-106">Physical retail stores lose sales because when customers look for an item, it's not present on the shelf.</span></span> <span data-ttu-id="4cc63-107">При этом товар может находиться на складе магазина, а его просто не вынесли в зал.</span><span class="sxs-lookup"><span data-stu-id="4cc63-107">However, the item could have been in the back of the store and not been restocked.</span></span> <span data-ttu-id="4cc63-108">Руководство магазинов хотело бы повысить эффективность работы сотрудников, включив возможность автоматического получения уведомлений о необходимости пополнить товар.</span><span class="sxs-lookup"><span data-stu-id="4cc63-108">Stores would like to use their staff more efficiently and get automatically notified when items need restocking.</span></span>

## <a name="solution"></a><span data-ttu-id="4cc63-109">Решение</span><span class="sxs-lookup"><span data-stu-id="4cc63-109">Solution</span></span>

<span data-ttu-id="4cc63-110">В примере решения в каждом магазине используется пограничное устройство, например Azure Stack Edge, которое эффективно обрабатывает данные, получаемые с камер, в магазине.</span><span class="sxs-lookup"><span data-stu-id="4cc63-110">The solution example uses an edge device, like an Azure Stack Edge in each store, which efficiently processes data from cameras in the store.</span></span> <span data-ttu-id="4cc63-111">Такая оптимальная схема позволяет магазинам передавать в облако только нужные события и изображения.</span><span class="sxs-lookup"><span data-stu-id="4cc63-111">This optimized design lets stores send only relevant events and images to the cloud.</span></span> <span data-ttu-id="4cc63-112">Конфигурация подразумевает экономию пропускной способности, пространства для хранения и обеспечивает конфиденциальность клиентов.</span><span class="sxs-lookup"><span data-stu-id="4cc63-112">The design saves bandwidth, storage space, and ensures customer privacy.</span></span> <span data-ttu-id="4cc63-113">По мере считывания кадров с каждой камеры модель машинного обучения обрабатывает изображение и возвращает все области, нуждающиеся в пополнении товарных запасов.</span><span class="sxs-lookup"><span data-stu-id="4cc63-113">As frames are read from each camera, an ML model processes the image and returns any out of stock areas.</span></span> <span data-ttu-id="4cc63-114">Изображение и области, нуждающиеся в пополнении товарных запасов, отображаются в локальном веб-приложении.</span><span class="sxs-lookup"><span data-stu-id="4cc63-114">The image and out of stock areas are displayed on a local web app.</span></span> <span data-ttu-id="4cc63-115">Эти данные можно отправить в среду "Аналитика временных рядов", чтобы отобразить аналитические сведения в Power BI.</span><span class="sxs-lookup"><span data-stu-id="4cc63-115">This data can be sent to a Time Series Insight environment to show insights in Power BI.</span></span>

![Архитектура решения для обнаружения отсутствия товара с помощью пограничного устройства](media/pattern-out-of-stock-at-edge/solution-architecture.png)

<span data-ttu-id="4cc63-117">Решение работает следующим образом:</span><span class="sxs-lookup"><span data-stu-id="4cc63-117">Here's how the solution works:</span></span>

1. <span data-ttu-id="4cc63-118">Изображения записываются из сетевой камеры по протоколу HTTP или RTSP.</span><span class="sxs-lookup"><span data-stu-id="4cc63-118">Images are captured from a network camera over HTTP or RTSP.</span></span>
2. <span data-ttu-id="4cc63-119">Размер изображения изменяется, и изображение отправляется в драйвер вывода, который взаимодействует с моделью машинного обучения, чтобы определить, есть ли изображения с отсутствием товара.</span><span class="sxs-lookup"><span data-stu-id="4cc63-119">The image is resized and sent to the inference driver, which communicates with the ML model to determine if there are any out of stock images.</span></span>
3. <span data-ttu-id="4cc63-120">Модель машинного обучения выводит все области, нуждающиеся в пополнении товарных запасов.</span><span class="sxs-lookup"><span data-stu-id="4cc63-120">The ML model returns any out of stock areas.</span></span>
4. <span data-ttu-id="4cc63-121">Драйвер вывода передает необработанное изображение в большой двоичный объект (если он указан) и отправляет результаты из модели в Центр Интернета вещей и обработчик ограничивающего прямоугольника на устройстве.</span><span class="sxs-lookup"><span data-stu-id="4cc63-121">The inferencing driver uploads the raw image to a blob (if specified), and sends the results from the model to Azure IoT Hub and a bounding box processor on the device.</span></span>
5. <span data-ttu-id="4cc63-122">Обработчик ограничивающего прямоугольника добавляет ограничивающие прямоугольники на изображение и кэширует путь к изображению в выполняющейся в памяти базе данных.</span><span class="sxs-lookup"><span data-stu-id="4cc63-122">The bounding box processor adds bounding boxes to the image and caches the image path in an in-memory database.</span></span>
6. <span data-ttu-id="4cc63-123">Веб-приложение запрашивает изображения и показывает их в порядке получения.</span><span class="sxs-lookup"><span data-stu-id="4cc63-123">The web app queries for images and shows them in the order received.</span></span>
7. <span data-ttu-id="4cc63-124">Сообщения из Центра Интернета вещей объединяются в службе "Аналитика временных рядов".</span><span class="sxs-lookup"><span data-stu-id="4cc63-124">Messages from IoT Hub are aggregated in Time Series Insights.</span></span>
8. <span data-ttu-id="4cc63-125">В Power BI отображается интерактивный отчет о недостающих товарах за период времени и данные из службы "Аналитика временных рядов".</span><span class="sxs-lookup"><span data-stu-id="4cc63-125">Power BI displays an interactive report of out of stock items over time with the data from Time Series Insights.</span></span>


## <a name="components"></a><span data-ttu-id="4cc63-126">Components</span><span class="sxs-lookup"><span data-stu-id="4cc63-126">Components</span></span>

<span data-ttu-id="4cc63-127">Это решение использует следующие компоненты.</span><span class="sxs-lookup"><span data-stu-id="4cc63-127">This solution uses the following components:</span></span>

| <span data-ttu-id="4cc63-128">Уровень</span><span class="sxs-lookup"><span data-stu-id="4cc63-128">Layer</span></span> | <span data-ttu-id="4cc63-129">Компонент</span><span class="sxs-lookup"><span data-stu-id="4cc63-129">Component</span></span> | <span data-ttu-id="4cc63-130">Описание</span><span class="sxs-lookup"><span data-stu-id="4cc63-130">Description</span></span> |
|----------|-----------|-------------|
| <span data-ttu-id="4cc63-131">Локальное оборудование</span><span class="sxs-lookup"><span data-stu-id="4cc63-131">On-premises hardware</span></span> | <span data-ttu-id="4cc63-132">Сетевая камера</span><span class="sxs-lookup"><span data-stu-id="4cc63-132">Network camera</span></span> | <span data-ttu-id="4cc63-133">Необходимо указать сетевую камеру с каналом HTTP или RTSP, чтобы предоставить изображения для вывода.</span><span class="sxs-lookup"><span data-stu-id="4cc63-133">A network camera is required, with either an HTTP or RTSP feed to provide the images for inference.</span></span> |
| <span data-ttu-id="4cc63-134">Azure</span><span class="sxs-lookup"><span data-stu-id="4cc63-134">Azure</span></span> | <span data-ttu-id="4cc63-135">Центр Интернета вещей Azure</span><span class="sxs-lookup"><span data-stu-id="4cc63-135">Azure IoT Hub</span></span> | <span data-ttu-id="4cc63-136">[Центр Интернета вещей](/azure/iot-hub/) осуществляет подготовку устройств и обмен сообщениями для пограничных устройств.</span><span class="sxs-lookup"><span data-stu-id="4cc63-136">[Azure IoT Hub](/azure/iot-hub/) handles device provisioning and messaging for the edge devices.</span></span> |
|  | <span data-ttu-id="4cc63-137">Azure Time Series Insights</span><span class="sxs-lookup"><span data-stu-id="4cc63-137">Azure Time Series Insights</span></span> | <span data-ttu-id="4cc63-138">В [службе "Аналитика временных рядов Azure"](/azure/time-series-insights/) хранятся сообщения из Центра Интернета вещей для визуализации.</span><span class="sxs-lookup"><span data-stu-id="4cc63-138">[Azure Time Series Insights](/azure/time-series-insights/) stores the messages from IoT Hub for visualization.</span></span> |
|  | <span data-ttu-id="4cc63-139">В Power BI.</span><span class="sxs-lookup"><span data-stu-id="4cc63-139">Power BI</span></span> | <span data-ttu-id="4cc63-140">[Microsoft Power BI](https://powerbi.microsoft.com/) предоставляет бизнес-отчеты о случаях отсутствия товарных запасов.</span><span class="sxs-lookup"><span data-stu-id="4cc63-140">[Microsoft Power BI](https://powerbi.microsoft.com/) provides business-focused reports of out of stock events.</span></span> <span data-ttu-id="4cc63-141">Power BI предоставляет простой в использовании интерфейс панели мониторинга для просмотра выходных данных Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="4cc63-141">Power BI provides an easy-to-use dashboard interface for viewing the output from Azure Stream Analytics.</span></span> |
| <span data-ttu-id="4cc63-142">Устройство Azure Stack Edge или</span><span class="sxs-lookup"><span data-stu-id="4cc63-142">Azure Stack Edge or</span></span><br><span data-ttu-id="4cc63-143">Azure IoT Edge</span><span class="sxs-lookup"><span data-stu-id="4cc63-143">Azure IoT Edge device</span></span> | <span data-ttu-id="4cc63-144">Azure IoT Edge</span><span class="sxs-lookup"><span data-stu-id="4cc63-144">Azure IoT Edge</span></span> | <span data-ttu-id="4cc63-145">[Azure IoT Edge](/azure/iot-edge/) управляет средой выполнения для локальных контейнеров и осуществляет управление устройствами и обновлениями.</span><span class="sxs-lookup"><span data-stu-id="4cc63-145">[Azure IoT Edge](/azure/iot-edge/) orchestrates the runtime for the on-premises containers and handles device management and updates.</span></span>|
| | <span data-ttu-id="4cc63-146">Project Brainwave в Azure</span><span class="sxs-lookup"><span data-stu-id="4cc63-146">Azure project brainwave</span></span> | <span data-ttu-id="4cc63-147">На устройстве Azure Stack Edge [Project Brainwave](https://blogs.microsoft.com/ai/build-2018-project-brainwave/) использует программируемые пользователем вентильные матрицы для ускорения вывода Машинного обучения.</span><span class="sxs-lookup"><span data-stu-id="4cc63-147">On an Azure Stack Edge device, [Project Brainwave](https://blogs.microsoft.com/ai/build-2018-project-brainwave/) uses Field-Programmable Gate Arrays (FPGAs) to accelerate ML inferencing.</span></span>|

## <a name="issues-and-considerations"></a><span data-ttu-id="4cc63-148">Проблемы и рекомендации</span><span class="sxs-lookup"><span data-stu-id="4cc63-148">Issues and considerations</span></span>

<span data-ttu-id="4cc63-149">Во время выбора варианта реализации этого решения необходимо учитывать приведенные ниже моменты.</span><span class="sxs-lookup"><span data-stu-id="4cc63-149">Consider the following points when deciding how to implement this solution:</span></span>

### <a name="scalability"></a><span data-ttu-id="4cc63-150">Масштабируемость</span><span class="sxs-lookup"><span data-stu-id="4cc63-150">Scalability</span></span>

<span data-ttu-id="4cc63-151">Большинство моделей машинного обучения могут работать только с определенным количеством кадров в секунду в зависимости от предоставленного оборудования.</span><span class="sxs-lookup"><span data-stu-id="4cc63-151">Most machine learning models can only run at a certain number of frames per second, depending on the provided hardware.</span></span> <span data-ttu-id="4cc63-152">Определите оптимальную частоту выборки для камер, чтобы конвейер Машинного обучения не выполнял резервное копирование.</span><span class="sxs-lookup"><span data-stu-id="4cc63-152">Determine the optimal sample rate from your camera(s) to ensure that the ML pipeline doesn't back up.</span></span> <span data-ttu-id="4cc63-153">Оборудование различных типов будет работать с разным количеством камер и частотой кадров.</span><span class="sxs-lookup"><span data-stu-id="4cc63-153">Different types of hardware will handle different numbers of cameras and frame rates.</span></span>

### <a name="availability"></a><span data-ttu-id="4cc63-154">Доступность</span><span class="sxs-lookup"><span data-stu-id="4cc63-154">Availability</span></span>

<span data-ttu-id="4cc63-155">Важно предусмотреть сценарий, когда у пограничного устройства пропадает подключение.</span><span class="sxs-lookup"><span data-stu-id="4cc63-155">It's important to consider what might happen if the edge device loses connectivity.</span></span> <span data-ttu-id="4cc63-156">Определите, какие данные могут быть потеряны из службы "Аналитика временных рядов" и панели мониторинга Power BI.</span><span class="sxs-lookup"><span data-stu-id="4cc63-156">Consider what data might be lost from the Time Series Insights and Power BI dashboard.</span></span> <span data-ttu-id="4cc63-157">Приведенный пример решения не предусматривает высокую доступность.</span><span class="sxs-lookup"><span data-stu-id="4cc63-157">The example solution as provided isn't designed to be highly available.</span></span>

### <a name="manageability"></a><span data-ttu-id="4cc63-158">Управляемость</span><span class="sxs-lookup"><span data-stu-id="4cc63-158">Manageability</span></span>

<span data-ttu-id="4cc63-159">Это решение может масштабироваться на множество устройств и расположений, что может оказаться неудобным.</span><span class="sxs-lookup"><span data-stu-id="4cc63-159">This solution can span many devices and locations, which could get unwieldy.</span></span> <span data-ttu-id="4cc63-160">Службы Интернета вещей Azure могут автоматически переводить новые расположения и устройства в режим подключения и обновлять их.</span><span class="sxs-lookup"><span data-stu-id="4cc63-160">Azure's IoT services can automatically bring new locations and devices online and keep them up to date.</span></span> <span data-ttu-id="4cc63-161">Необходимо также соблюдать надлежащие процедуры управления данными.</span><span class="sxs-lookup"><span data-stu-id="4cc63-161">Proper data governance procedures must be followed as well.</span></span>

### <a name="security"></a><span data-ttu-id="4cc63-162">Безопасность</span><span class="sxs-lookup"><span data-stu-id="4cc63-162">Security</span></span>

<span data-ttu-id="4cc63-163">Этот шаблон подразумевает обработку потенциально конфиденциальных данных.</span><span class="sxs-lookup"><span data-stu-id="4cc63-163">This pattern handles potentially sensitive data.</span></span> <span data-ttu-id="4cc63-164">Убедитесь, что ключи регулярно меняются, а разрешения для учетной записи хранения Azure и локальных общих папок заданы правильно.</span><span class="sxs-lookup"><span data-stu-id="4cc63-164">Make sure keys are regularly rotated and the permissions on the Azure Storage Account and local shares are correctly set.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4cc63-165">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="4cc63-165">Next steps</span></span>

<span data-ttu-id="4cc63-166">Дополнительные сведения по темам, описанным в этой статье:</span><span class="sxs-lookup"><span data-stu-id="4cc63-166">To learn more about topics introduced in this article:</span></span>
- <span data-ttu-id="4cc63-167">В этом шаблоне используются несколько служб, связанных с Интернетом вещей, в том числе [Azure IoT Edge](/azure/iot-edge/), [Центр Интернета вещей](/azure/iot-hub/) и [служба "Аналитика временных рядов Azure"](/azure/time-series-insights/).</span><span class="sxs-lookup"><span data-stu-id="4cc63-167">Multiple IoT related services are used in this pattern, including [Azure IoT Edge](/azure/iot-edge/), [Azure IoT Hub](/azure/iot-hub/), and [Azure Time Series Insights](/azure/time-series-insights/).</span></span>
- <span data-ttu-id="4cc63-168">Чтобы узнать больше о Microsoft Project Brainwave, ознакомьтесь с [объявлением блога](https://blogs.microsoft.com/ai/build-2018-project-brainwave/) и просмотрите видео [об ускоренном Машинном обучении Azure с Project Brainwave](https://www.youtube.com/watch?v=DJfMobMjCX0).</span><span class="sxs-lookup"><span data-stu-id="4cc63-168">To learn more about Microsoft Project Brainwave, see [the blog announcement](https://blogs.microsoft.com/ai/build-2018-project-brainwave/) and checkout out the [Azure Accelerated Machine Learning with Project Brainwave video](https://www.youtube.com/watch?v=DJfMobMjCX0).</span></span>
- <span data-ttu-id="4cc63-169">См. [рекомендации по проектированию гибридных приложений и ответы на дополнительные вопросы](overview-app-design-considerations.md).</span><span class="sxs-lookup"><span data-stu-id="4cc63-169">See [Hybrid app design considerations](overview-app-design-considerations.md) to learn more about best practices and to get answers to any additional questions.</span></span>
- <span data-ttu-id="4cc63-170">См. сведения обо [всех продуктах и решениях Azure Stack](/azure-stack).</span><span class="sxs-lookup"><span data-stu-id="4cc63-170">See the [Azure Stack family of products and solutions](/azure-stack) to learn more about the entire portfolio of products and solutions.</span></span>

<span data-ttu-id="4cc63-171">Когда вы будете готовы протестировать пример решения, переходите к [руководству по развертыванию решения вывода ML Edge](https://aka.ms/edgeinferencingdeploy).</span><span class="sxs-lookup"><span data-stu-id="4cc63-171">When you're ready to test the solution example, continue with the [Edge ML inferencing solution deployment guide](https://aka.ms/edgeinferencingdeploy).</span></span> <span data-ttu-id="4cc63-172">В этом руководстве содержатся пошаговые инструкции по развертыванию и тестированию компонентов.</span><span class="sxs-lookup"><span data-stu-id="4cc63-172">The deployment guide provides step-by-step instructions for deploying and testing its components.</span></span>
