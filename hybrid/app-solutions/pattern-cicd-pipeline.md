---
title: Шаблон DevOps для Azure Stack Hub
description: Узнайте о шаблоне DevOps, чтобы обеспечить согласованность между развертываниями в Azure и Azure Stack Hub.
author: BryanLa
ms.topic: article
ms.date: 11/05/2019
ms.author: bryanla
ms.reviewer: anajod
ms.lastreviewed: 11/05/2019
ms.openlocfilehash: e26056a9507a7467473b009725d4f210d9d59ec8
ms.sourcegitcommit: d2def847937178f68177507be151df2aa8e25d53
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/20/2020
ms.locfileid: "86477241"
---
# <a name="devops-pattern"></a>Шаблон DevOps

Создайте код в одном расположении и разверните его в нескольких целевых расположениях в среде разработки, среде тестирования и рабочей среде, которые могут находиться в локальном центре обработки данных, в частных облаках или в общедоступном облаке.

## <a name="context-and-problem"></a>Контекст и проблема

Непрерывность, безопасность и надежность развертывания приложений являются ключевыми для организации и критически важными для команд разработчиков.

Приложениям часто требуется рефакторинг кода для выполнения в каждой целевой среде. Это означает, что приложение не является полностью переносимым. Оно должно быть обновлено, протестировано и проверено для перемещения в каждую среду. Например, код, написанный в среде разработки, должен быть переписан для использования в тестовой среде, а затем снова переписан, когда он наконец окажется в рабочей среде. Кроме того, этот код особенно привязан к узлу. Это повышает стоимость и сложность обслуживания приложения. Каждая версия приложения привязана к отдельной среде. Повышенная сложность и дублирование увеличивают риск нарушения безопасности и снижения качества кода. Кроме того, код нельзя повторно развернуть при удалении и восстановлении неработоспособных узлов или развертывании дополнительных узлов в соответствии с изменяющимися требованиями.

## <a name="solution"></a>Решение

Шаблон DevOps позволяет создать, протестировать и развернуть приложение, работающее в нескольких облаках. Этот шаблон основан на технологии непрерывной интеграции и непрерывной поставки. Благодаря непрерывной интеграции код создается и тестируется каждый раз, когда член команды фиксирует изменения в системе управления версиями. Непрерывная поставка позволяет автоматизировать воспроизведение каждого шага в среде сборки в рабочей среде. Вместе эти процессы образуют процесс выпуска, который поддерживает развертывание в различных средах. С помощью этого шаблона можно создать черновик кода, а затем развертывать один и тот же код в локальной среде, в разных частных облаках и в общедоступных облаках. Различия в среде требуют изменения файла конфигурации, а не внесения изменений в код.

![Шаблон DevOps](media/pattern-cicd-pipeline/hybrid-ci-cd.png)

Благодаря согласованному набору средств разработки в локальной среде, частном облаке и общедоступном облаке можно реализовать методику непрерывной интеграции и непрерывной поставки. Приложения и службы, развертываемые с помощью шаблона DevOps, взаимозаменяемы и могут выполняться в любой среде, используя функции локальной среды и возможности общедоступного облака.

Использование конвейера выпуска DevOps помогает:

- инициировать новую сборку при фиксации кода в одном репозитории;
- автоматически развернуть новый созданный код в общедоступном облаке для пользовательского приемочного тестирования;
- автоматически развернуть код, прошедший тестирование, в общедоступном облаке.

## <a name="issues-and-considerations"></a>Проблемы и рекомендации

Шаблон DevOps предназначен обеспечить согласованность развертываний независимо от целевой среды. Однако его возможности в облачных и локальных средах различны. Учтите следующие моменты.

- Функции, конечные точки, службы и другие ресурсы в развертывании доступны во целевых расположениях развертывания?
- Хранятся ли артефакты конфигурации в расположениях, доступных для разных облаков?
- Будут ли параметры развертывания работать во всех целевых средах?
- Доступны ли свойства, определяемые ресурсами, в целевых облаках?

Дополнительные сведения см. в разделе [Разработка шаблонов Azure Resource Manager для обеспечения согласованности с облаком](/azure/azure-resource-manager/templates-cloud-consistency).

Кроме того, при выборе способа реализации этого шаблона следует учитывать следующее.

### <a name="scalability"></a>Масштабируемость

Системы автоматизации развертывания являются ключевой контрольной точкой в шаблонах DevOps. Варианты реализации могут быть различны. Выбор правильного размера сервера зависит от объема ожидаемой рабочей нагрузки. Масштабировать виртуальные машины затратнее, чем контейнеры. Но если для масштабирования нужно использовать контейнеры, их нужно применять и в процессе сборки.

### <a name="availability"></a>Доступность

Доступность в контексте сервера шаблона DevOps означает возможность восстановления сведений о состоянии, связанных с рабочим процессом, например результатов теста, зависимостей кода или других артефактов. Для оценки требований к доступности рекомендуем использовать две общие метрики:

- Целевое время восстановления (RTO) указывает, как долго вы сможете обходиться без системы.

- Целевая точка восстановления (RPO) указывает, какой объем данных допустимо потерять, если нарушение работы служб повлияет на функционирование системы.

На практике под терминами RTO и RPO подразумеваются избыточность и резервное копирование. В глобальном облаке Azure доступность означает не восстановление оборудования (эта возможность предоставляется в Azure), а поддержание работоспособности систем DevOps. В Azure Stack Hub поддерживается восстановление оборудования.

Еще одним важным положением проектировании системы, используемой для автоматизации развертывания, является управление доступом и правильное управление правами, необходимыми для развертывания служб в облачных средах. Какие права требуются для создания, удаления или изменения развертываний? Например, один набор прав обычно требуется для создания группы ресурсов в Azure, а другой — для развертывания служб в группе ресурсов.

### <a name="manageability"></a>Управляемость

При проектированию любой системы, основанной на шаблоне DevOps, должны учитываться автоматизация, ведение журнала и оповещение для каждой службы в портфеле. Используйте общие службы, группу по приложениям или и то, и другое, а также следите за политиками безопасности и системой управления.

Развертывайте рабочие среды, а также среды разработки и тестирования в отдельных группах ресурсов в Azure или Azure Stack Hub. Затем вы сможете отслеживать ресурсы каждой среды и выполнять сведение выставляемых счетов по группам ресурсов. Можно также удалить ресурсы в виде набора, что очень удобно для тестирования развернутых служб.

## <a name="when-to-use-this-pattern"></a>Когда следует использовать этот шаблон

Используйте этот шаблон в следующих случаях:

- Вы можете разработать код в одной среде, которая отвечает потребностям ваших разработчиков, и развернуть его в среде, подходящей для вашего решения, в которой может быть трудно разработать новый код.
- Вы можете использовать код и инструменты, которые предпочитают ваши разработчики, если они способны обеспечить процесс непрерывной интеграции и непрерывной поставки в шаблоне DevOps.

Этот шаблон не рекомендуется использовать в следующих случаях:

- Если вы не можете автоматизировать инфраструктуру, подготовку ресурсов, настройку, работу с удостоверениями и задачи по обеспечению безопасности.
- Если у команд нет доступа к гибридным облачным ресурсам для реализации непрерывной интеграции и непрерывного развертывания (CI/CD).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения по темам, описанным в этой статье:

- См. сведения об [Azure DevOps и связанных средствах, включая Azure Repos и Azure Pipelines](/azure/devops).
- См. сведения обо [всех продуктах и решениях Azure Stack](/azure-stack).

Когда вы будете готовы протестировать пример решения, переходите к [руководству по развертыванию гибридного решения CI/CD](https://aka.ms/hybriddevopsdeploy). В этом руководстве содержатся пошаговые инструкции по развертыванию и тестированию компонентов. Вы узнали, как развернуть приложение в Azure и Azure Stack Hub с помощью гибридного конвейера непрерывной интеграции и непрерывной поставки (CI/CD).
