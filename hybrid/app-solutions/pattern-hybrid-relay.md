---
title: Шаблон гибридного ретранслятора в Azure и Azure Stack Hub
description: Используйте шаблон гибридного ретранслятора в Azure и Azure Stack Hub, чтобы подключиться к пограничным ресурсам, защищенным брандмауэрами.
author: BryanLa
ms.topic: article
ms.date: 11/05/2019
ms.author: bryanla
ms.reviewer: anajod
ms.lastreviewed: 11/05/2019
ms.openlocfilehash: 03b20a20a04f620c977fb20e1ea26f5982e42721
ms.sourcegitcommit: bb3e40b210f86173568a47ba18c3cc50d4a40607
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/17/2020
ms.locfileid: "84911151"
---
# <a name="hybrid-relay-pattern"></a>Шаблон гибридного ретранслятора

Узнайте, как подключиться к граничным ресурсам или устройствам, защищенным брандмауэрами, с помощью шаблона гибридной трансляции и Azure Relay.

## <a name="context-and-problem"></a>Контекст и проблема

Пограничные устройства часто находятся за корпоративным брандмауэром или устройством NAT. Хотя они защищены, у них может не быть возможности обмениваться данными с общедоступным облаком или пограничными устройствами в других корпоративных сетях. Возможно, понадобится предоставить пользователям безопасный доступ к определенным портам и функциональным возможностям в общедоступном облаке.

## <a name="solution"></a>Решение

Шаблон гибридного ретранслятора использует Azure Relay для установления туннеля WebSocket между двумя конечными точками, которые не могут напрямую обмениваться данными. Устройства за пределами локальной среды, которые необходимо подключить к локальной конечной точке, будут подключены к конечной точке в общедоступном облаке. Эта конечная точка перенаправит трафик на стандартные маршруты по безопасному каналу. Конечная точка в локальной среде получает трафик и направляет его в нужное место назначения.

![Архитектура шаблона решения для гибридного ретранслятора](media/pattern-hybrid-relay/solution-architecture.png)

Шаблон гибридного ретранслятора работает следующим образом:

1. Устройство подключается к виртуальной машине в Azure по заранее определенному порту.
2. Трафик перенаправляется в Azure Relay в Azure.
3. Виртуальная машина в концентраторе Azure Stack, которая уже установила длительное подключение к Azure Relay, получает трафик и перенаправляет его в место назначения.
4. Локальная служба или конечная точка обрабатывает запрос.

## <a name="components"></a>Components

Это решение использует следующие компоненты.

| Уровень | Компонент | Описание |
|----------|-----------|-------------|
| Azure | Azure | Виртуальная машина Azure предоставляет общедоступную конечную точку для локального ресурса. |
| | Ретранслятор Azure | [Azure Relay](/azure/azure-relay/) предоставляет инфраструктуру для обслуживания туннеля и подключения между виртуальной машиной Azure и виртуальной машиной центра Azure Stack.|
| Azure Stack Hub | Службы вычислений | Виртуальная машина Azure Stack Hub предоставляет серверную часть туннеля гибридного ретранслятора. |
| | Память | Кластер обработчика AKS, развернутый в Azure Stack Hub, предоставляет масштабируемый отказоустойчивый механизм для запуска контейнера API "Распознавание лиц".|

## <a name="issues-and-considerations"></a>Проблемы и рекомендации

Во время выбора варианта реализации этого решения необходимо учитывать приведенные ниже моменты.

### <a name="scalability"></a>Масштабируемость

Этот шаблон разрешает только сопоставление портов 1:1 в клиенте и на сервере. Например, если порт 80 туннелирован для одной службы в конечной точке Azure, его нельзя использовать для другой службы. Сопоставления портов следует планировать соответствующим образом. Azure Relay и виртуальные машины должны быть соответствующим образом масштабированы для управления трафиком.

### <a name="availability"></a>Доступность

Эти туннели и соединения не являются избыточными. Для обеспечения высокой доступности может потребоваться реализовать код проверки ошибок. Кроме того, можно использовать пул виртуальных машин, подключенных к Azure Relay, за пределами подсистемы балансировки нагрузки.

### <a name="manageability"></a>Управляемость

Это решение может масштабироваться на множество устройств и расположений, что может оказаться неудобным. Службы Интернета вещей Azure могут автоматически переводить новые расположения и устройства в режим подключения и обновлять их.

### <a name="security"></a>Безопасность

Этот шаблон, как показано ниже, обеспечивает свободный доступ к порту на внутреннем устройстве с пограничного устройства. Рассмотрите возможность добавления механизма проверки подлинности в службу на внутреннем устройстве или перед конечной точкой гибридного ретранслятора.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения по темам, описанным в этой статье:

- В этом шаблоне используется Azure Relay. Дополнительные сведения см. в [документации по Azure Relay](/azure/azure-relay/).
- См. [рекомендации по проектированию гибридных приложений и ответы на дополнительные вопросы](overview-app-design-considerations.md).
- См. сведения обо [всех продуктах и решениях Azure Stack](/azure-stack).

Когда вы будете готовы протестировать пример решения, продолжите работу с [руководством по развертыванию решения гибридного ретранслятора](https://aka.ms/hybridrelaydeployment). В этом руководстве содержатся пошаговые инструкции по развертыванию и тестированию компонентов.